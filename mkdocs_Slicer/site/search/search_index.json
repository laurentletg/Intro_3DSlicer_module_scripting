{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"3D Slicer homemade documentation","text":""},{"location":"#installing-slicer-and-the-brats_annotation-module-work-in-progress","title":"Installing Slicer and the BraTS_annotation module (work-in-progress)","text":"<ol> <li>Download 3D slicer</li> <li>Enable developer mode (Edit &gt; Application Settings &gt; Developer &gt; Check Enable developer mode). Slicer will restart. </li> <li>Clone (or download) this repository</li> <li>Activate the checkbox <code>Enable developer mode</code> in <code>Edit -&gt; Application Settings -&gt; Developer -&gt; Enable developer mode</code>. </li> <li>Add the path of this repository in <code>Edit -&gt; Application Settings -&gt; Modules -&gt; Additional module paths</code>. Slicer must be restarted.</li> <li>If the module appears in red, this is typically because there is a bug in the .py file. You can check for a traceback in the python console embeded in 3D Slicer. </li> <li>Potential issue with Qt (3D Slicer splash screen appears and disappears, fail to load) : this happens if Qt is not installed on your system (e.g on a new Linux install) : example of Qt install on Ubuntu </li> </ol>"},{"location":"#official-slicer-ressources","title":"Official Slicer ressources","text":"<ul> <li>Main page</li> <li>Download page</li> <li>Documentation</li> <li>Developer guide</li> <li>Discourse</li> </ul>"},{"location":"#python-programing-in-slicer","title":"Python programing in Slicer","text":"<p>The Slicer python API is not fully documented but slowly improving including here. I usually try first with the script repository or discourse forum. For the segmentation editor module you can find methods in this page. Trying to find methods using tab completion sometimes work in combination with the official C++ API. A debugging tool exists, I was only able to make it work with VSCode not PyCharm.  ChatGPT is hit or miss, sometimes come up with hallucinated functions. </p> <ul> <li>Slicer Programming Tutorial</li> <li>Beyond the basics programming</li> <li>Python script repository</li> <li>Script repository</li> <li>Slicer API (C++)</li> </ul>"},{"location":"#slicer-jupyter","title":"Slicer Jupyter","text":"<p>Useful for prototyping and exploring the python API</p> <ul> <li>Overview on github</li> <li>Jupyter notebook examples</li> <li>Other segmentation examples</li> </ul>"},{"location":"#slicer-module-development","title":"Slicer module development","text":"<p>In order of difficulty/complexity:</p> <ul> <li>Basic Python module (Hello python)</li> <li>Robarts lab documentation including well documented example </li> <li>PerkLab python module development tutorial (includes Qt designer)</li> <li>Developing and contributing extensions for 3D Slicer</li> </ul>"},{"location":"#videos-and-other-ressources","title":"Videos and other ressources","text":"<ul> <li>Module development series</li> <li>Short series showing basic python programming and module development (in German with English subtitles)</li> </ul>"},{"location":"#python-module-examples","title":"Python module examples","text":"<ul> <li>Robarts lab good baseline code (without .ui file - requires manually editing the widgets in the .py file)</li> <li>Slicer Case Iterator: iterate through cases </li> </ul>"},{"location":"#misc-ressources","title":"Misc ressources","text":""},{"location":"#monai-label-3d-slicer-extension","title":"MONAI label (3D Slicer extension)","text":"<p>Active learning tool - DL assited annotation.</p> <ul> <li>MONAI label. </li> <li>MONAI label youtube - Overview</li> <li>MONAI label youtube - Set-up</li> <li>MONAI label github</li> </ul>"},{"location":"#pyqt","title":"PyQt","text":"<p>Building a GUI outside of Slicer (helps to understand how to build a GUI in Slicer) - PyQt tutorial - PyQt video series</p>"},{"location":"#code-repository","title":"Code repository","text":""},{"location":"Code_repository/","title":"Code repository","text":"<ul> <li>Subject hierarchy</li> <li>Save volume statistis</li> </ul>"},{"location":"Code_repository/#segmentation","title":"Segmentation","text":""},{"location":"Code_repository/#getting-specific-segments","title":"Getting specific segments","text":"<ul> <li>Hierarchical data structure of the segmentation node : SegmentationNode -&gt; Segmentation -&gt; Segment</li> <li>Example on the script repository <pre><code>segmentation = slicer.util.getNode('Segmentation')\n#If the segment name is already known, you can get the segment by name:\nsegmentname = 'Segment_1'\n\n#Change the 3D display properties of the segmentation\ndisplayNode = segmentation.GetDisplayNode()\ndisplayNode.SetOpacity3D(0.9)  # Set overall opacity of the segmentation\ndisplayNode.SetSegmentOpacity3D(segmentname, 0.2)  # Set opacity of a single segment\n\n\n# Segment color is not just a display property, but it is stored in the segment itself (and stored in the segmentation file)\nsegment = segmentation.GetSegmentation().GetSegment(segmentname)\nsegment.SetColor(1, 0, 0)  # red\n</code></pre></li> </ul>"},{"location":"Code_repository/#subject-hierarchy","title":"Subject hierarchy","text":"<ul> <li>Subject hierarchy <p> <pre><code>import slicer\ndef subjectHierarchy(self):\n    # Get the subject hierarchy node\n    shNode = slicer.mrmlScene.GetSubjectHierarchyNode()\n\n    # Get scene item ID first because it is the root item:\n    sceneItemID = shNode.GetSceneItemID()\n    # Get the scene item ID (check if the scene item exists)\n    subjectItemID = shNode.GetItemChildWithName(shNode.GetSceneItemID(), self.currentCase)\n    if not subjectItemID:\n        subjectItemID = shNode.CreateSubjectItem(shNode.GetSceneItemID(), self.currentCase)\n\n    # TODO: this will need to be updated when moving to multiple studies per patient (or done in a separate script)\n    # Creat a folder to include a study (if more than one study)\n    # check if the folder exists and if not create it (avoid recreating a new one when reloading a mask)\n    Study_name = 'Study to be updated'\n    folderID = shNode.GetItemChildWithName(subjectItemID, Study_name)\n    if not folderID:\n        folderID = shNode.CreateFolderItem(subjectItemID, Study_name)\n    # set under the subject\n    shNode.SetItemParent(folderID, subjectItemID)\n\n    # get all volume nodes\n    VolumeNodes = slicer.util.getNodesByClass('vtkMRMLVolumeNode')\n    VolumeNodeNames = [i.GetName() for i in VolumeNodes]\n    # Get all child (itemID = CT or MR series/sequences)\n    for i in VolumeNodeNames:\n        itemID = shNode.GetItemChildWithName(sceneItemID, i)\n        shNode.SetItemParent(itemID, folderID)\n    # same thing for segmentation nodes\n    SegmentationNodes = slicer.util.getNodesByClass('vtkMRMLSegmentationNode')\n    SegmentationNodeNames = [i.GetName() for i in SegmentationNodes]\n    # move all segmentation nodes to the subject\n    for i in SegmentationNodeNames:\n        itemID = shNode.GetItemChildWithName(sceneItemID, i)\n        shNode.SetItemParent(itemID, folderID)\n</code></pre></p> </li> </ul>"},{"location":"Code_repository/#save-volume-statistis","title":"Save volume statistis","text":"<pre><code>  def save_statistics(self):\n      volumeNode=slicer.util.getNodesByClass('vtkMRMLScalarVolumeNode')[0]\n      segmentationNode=slicer.util.getNodesByClass('vtkMRMLSegmentationNode')[0]\n      segmentationNode.SetReferenceImageGeometryParameterFromVolumeNode(volumeNode)\n      segStatLogic = SegmentStatistics.SegmentStatisticsLogic()\n      segStatLogic.getParameterNode().SetParameter(\"Segmentation\", segmentationNode.GetID())\n      segStatLogic.getParameterNode().SetParameter(\"ScalarVolume\", volumeNode.GetID())\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPlugin.obb_origin_ras.enabled\",str(True))\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPlugin.obb_diameter_mm.enables\",str(True))\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPlugin.obb_direction_ras_x_.enabled\", str(True))\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPlugin.obb_direction_ras_y_.enabled\",str(True))\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPlugin.obb_direction_ras_z_.enabled\", str(True))\n      segStatLogic.getParameterNode().SetParameter(\"LabelSegmentStatisticsPLugin.obb_diameter_mm.enables\", str(True))\n      segStatLogic.computeStatistics()\n      output_file_pt_id_instanceUid = re.findall(self.VOL_REGEX_PATTERN_PT_ID_INSTUID_SAVE, os.path.basename(self.currentCasePath))[0]\n\n\n      outputFilename = f'Volumes_{output_file_pt_id_instanceUid}.csv'\n      output_dir_volumes_csv = os.path.join(self.output_dir_labels, 'csv_volumes')\n      output_dir_volumes_csv = os.path.join(self.output_dir_labels, 'csv_volumes')\n      outputFilename = os.path.join(output_dir_volumes_csv, outputFilename)\n\n      segStatLogic.exportToCSVFile(outputFilename)\n      stats = segStatLogic.getStatistics()\n\n      # Read the csv and clean it up\n      df = pd.read_csv(outputFilename)\n      df.set_index('Segment')\n      df = df[['Segment', 'LabelmapSegmentStatisticsPlugin.volume_cm3']]\n      df.rename(columns={'LabelmapSegmentStatisticsPlugin.volume_cm3': \"Volumes\"}, inplace=True)\n      df['ID'] = df['Segment'].str.extract(\"(ID_[a-zA-Z0-90]+)_\")\n      df['Category'] = df['Segment'].str.extract(\"_([A-Z]+)$\")\n\n      if not os.path.exists(output_dir_volumes_csv):\n          os.makedirs(output_dir_volumes_csv)\n\n\n      if not os.path.isfile(outputFilename):\n          df.to_csv(outputFilename, index=False)\n          print(f'Wrote segmentation file here {outputFilename}')\n      else:\n          msg = qt.QMessageBox()\n          msg.setWindowTitle('Save As')\n          msg.setText(f'The file {outputFilename} already exists \\n Do you want to replace the existing file?')\n          msg.setIcon(qt.QMessageBox.Warning)\n          msg.setStandardButtons(qt.QMessageBox.Ok | qt.QMessageBox.Cancel)\n          msg.exec()\n          if msg.clickedButton() == msg.button(qt.QMessageBox.Ok):\n              df.to_csv(outputFilename, index=False)\n              print(f'Wrote segmentation file here {outputFilename}')\n</code></pre>"}]}